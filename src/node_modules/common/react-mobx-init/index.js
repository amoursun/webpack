import React from 'react'
import {render} from 'react-dom'
import {AppContainer} from 'react-hot-loader'
import {detectBrowser} from 'utils/lib/browser'
import AppCreator from './AppCreator'
import {errorRoutes} from 'module/Error/routes'
import {configure} from 'mobx';

configure({
  enforceActions: 'observed'
});
// import {useStrict} from 'mobx';
// useStrict(true); // 使用严格模式 useStrict not a function mobx4.x版本之上已经废弃useStrict, 3.x版本还有, 改用configure
let counter = 0;

function renderApp(routes, appState) {
  if (routes.childRoutes && typeof routes.childRoutes.concat === 'function') {
    routes.childRoutes = routes.childRoutes.concat(errorRoutes)
  }
  browserDiff();
  const MainApp = AppCreator(routes)
  counter++
  render(
    <AppContainer key={counter}>
      <MainApp context={appState}/>
    </AppContainer>,
    document.getElementById('root')
  )
}

function browserDiff() {
  const browser = window.BROWSER = detectBrowser()
  // console.log(window.BROWSER)
  let isIE9 = window.BROWSER.name === 'ie'
    && (window.BROWSER.version.slice(0, 1) === '9' || window.BROWSER.version.slice(0, 2) === '10');
  if (isIE9) {
    alert('当前浏览器不支持IE9')
  }
}

export default {
  initApp(routes, appState) {
    renderApp(routes, appState)
  }
}
